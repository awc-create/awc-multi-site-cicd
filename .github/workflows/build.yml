name: Build and Deploy Workflow

on:
  push:
    branches:
      - main
      - 'feat/**'
      - 'fix/**'
  repository_dispatch:

permissions:
  contents: read
  actions: write
  issues: write

jobs:
  checkout-repo:
    uses: ./.github/workflows/checkout.yml

  project-detection:
    needs: checkout-repo
    uses: ./.github/workflows/project.yml
    with:
      repo_path: site-repo

  static-pipeline:
    needs: project-detection
    uses: ./.github/workflows/static-pipeline.yml
    with:
      repo_path: site-repo

#   preview-deployment:
#     needs: static-pipeline
#     if: contains(github.ref, 'feat/') || contains(github.ref, 'fix/')
#     uses: ./.github/workflows/preview.yml
#     with:
#       repo_path: site-repo

#   production-deployment:
#     needs: static-pipeline
#     if: github.ref == 'refs/heads/main'
#     uses: ./.github/workflows/production.yml
#     with:
#       repo_path: site-repo
